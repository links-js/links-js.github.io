var getOs,getTagClass,injectCss,isYaml,stripQuotes;injectCss=function(t){var e,n;return n=void 0,"string"==typeof t&&(t=t.trim(),n=0===t.indexOf("/")||0===t.indexOf("http:")||0===t.indexOf("https:")?"link":"style",e=document.createElement(n),e.type="text/css","link"===n?(e.rel="stylesheet",e.href=t):e.innerHTML=t,document.head.appendChild(e),e)},getOs=function(){var t;return t=navigator.platform.toUpperCase(),t.indexOf("MAC")>-1?"mac":t.indexOf("WIN")>-1?"windows":t.indexOf("LINUX")>-1?"linux":"windows"},isYaml=function(t){return/\.(ya?ml)$/.test(t)},stripQuotes=function(t){return t.replace(/^"(.*)"$/,"$1")},getTagClass=function(t){var e;return e=1,t>10&&(e=10),t>25&&(e=25),t>50&&(e=50),t>100&&(e=100),"tag-"+e};
var getEngine,getTypeIcon,setDefaults,suggestionFn;setDefaults=function(n){return n.map(function(n){return"undefined"==typeof n.type&&(n.type="page"),n})},getEngine=function(n){return n=setDefaults(n),new Bloodhound({datumTokenizer:function(n){var e;return e=[],e=e.concat(Bloodhound.tokenizers.whitespace(n.name.replace(/[\(\)]/g,""))).concat(n.tags.map(function(n){return"#"+n})).concat(":"+n.type).concat(n.url)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:n,identify:function(n){return n.name}})},getTypeIcon=function(n){var e;switch(e="",n){case"file":e="fa-download";break;case"bookmark":e="fa-bookmark";break;default:e="fa-external-link-square"}return e},suggestionFn=function(n){var e;return e=n.tags.map(function(n){return"#"+n}).join(" "),'<div><div class="ta-obj">\n  <div class="ta-row">\n    <span class="name">'+n.name+'</span>\n    <span class="type"><i class="fa '+getTypeIcon(n.type)+'"></i></span>\n    <span class="tags">'+e+'</span>\n  </div>\n  <div class="ta-row">\n    <span class="url">'+n._url+"</span>\n  </div>\n</div></div>"};
angular.module("App",["ngRoute","ngStorage","angular-cache"]).filter("tagReplace",function(){return function(t){return t?t.replace(/tag:/gi,"#"):""}}).filter("noReferrer",function(){return function(t){return"https://href.li/?"+t}}).filter("filename",function(){return function(t){return t.split("/").slice(-1)[0]}}).filter("getFaviconUrl",function(){return function(t){return"https://www.google.com/s2/favicons?domain_url="+t}}).filter("getLastItem",function(){return function(t){return t.slice(-1)[0]}}).factory("LinksLoader",["$http","$q","$rootScope","$filter",function(t,e,n,r){var o,l,i,a;return l=function(t){var e,n;return n=t.config.url,e=null,e=e=isYaml(n)?jsyaml.load(t.data):t.data,e._url=n,e},i=function(t){return!!(Boolean(t)&&t instanceof Object&&t.hasOwnProperty("links"))||(console.error("Incorrect object:",t),!1)},a=function(t,e){var n;return n=e.links.map(function(t){return t._url=e._url,t._source=window.btoa(e._url),t}),t.concat(n)},o=function(t){return t.push(t.filter(i).reduce(a,[])),t},{load:function(){var i,a;return a=n.settings.url.split("\n").filter(function(t){return t.length>0}),i=a.map(function(n){return t.get(n).then(l,function(t){return console.error("HTTP error:",t),e.reject(t)})}),e.all(i).then(o).then(r("getLastItem"))}}}]).directive("myTypeahead",function(){return{restrict:"C",scope:!0,link:function(t,e,n){var r,o,l,i;return i={hint:!1,highlight:!0,minLength:1},r={name:"links",source:null,limit:t.$root.settings.limit,templates:{suggestion:suggestionFn},display:"name"},l=$(e[0]),o=null,t.$root.$watch("loadedLinks",function(e,n){return null!==e&&(r.source=getEngine(t.$root.loadedLinks),l.typeahead(i,r),l.bind("typeahead:select",function(e,n){var r;return r=t.$root.settings["page"===n.type?"openPage":"openFile"],r=stripQuotes(r),r="new"===r?"_blank":"_self",window.open(n.url,r)})),l.focus()}),t.$watch("term",function(){return l.val(t.term).trigger("input").focus()})}}}).factory("Settings",["$localStorage",function(t){var e,n;return n=["/db/db-global.yml","/db/db-"+getOs()+".yml"].join("\n"),e={url:n,openFile:"current",openPage:"new",cache:!0,limit:10},{reset:function(){return t.$reset(e)},storage:t.$default(e)}}]).controller("SettingsCtrl",["$scope","$rootScope","Settings","$http",function(t,e,n,r){var o;return o=function(){return t.status="Please reload page"},t.reset=function(){return n.reset(),o()},t.clear=function(){return r.defaults.cache.destroy(),o()}}]).controller("TagsCtrl",["$scope","$rootScope",function(t,e){var n;return n={},e.loadedLinks.map(function(t){return t.tags}).forEach(function(t){return t.forEach(function(t){return n[t]=n.hasOwnProperty(t)?n[t]+1:1})}),t.getClass=getTagClass,t.tags=n}]).controller("TypeCtrl",["$scope","$routeParams","$filter",function(t,e,n){return t.term=n("tagReplace")(e.term)}]).controller("ListCtrl",["$scope","$routeParams","$filter",function(t,e,n){var r,o;return r=null,o=function(){if(t.term.length>0)return t.change()},t.$root.$watch("loadedLinks",function(e,n){return r=getEngine(t.$root.loadedLinks),o()}),t.searchResults=[],t.change=function(){if(r)return r.search(t.term.trim(),function(e){return t.searchResults=e})},t.term=n("tagReplace")(e.term),o()}]).config(["$routeProvider",function(t){return t.when("/type/:term?",{templateUrl:"typeahead.html",controller:"TypeCtrl"}).when("/list/:term?",{templateUrl:"list.html",controller:"ListCtrl"}).when("/tags",{templateUrl:"tags.html"}).otherwise({redirectTo:"/type"})}]).run(["$http","$rootScope","Settings","CacheFactory","LinksLoader",function(t,e,n,r,o){return e.settings=n.storage,null!==e.settings.css&&injectCss(e.settings.css),e.settings.cache===!0&&(t.defaults.cache=r("defaultCache",{maxAge:9e5,cacheFlushInterval:36e5,deleteOnExpire:"aggressive",storageMode:"localStorage"})),o.load().then(function(t){return console.log("Links are loaded:",t.length),e.loadedLinks=t})}]);
//# sourceMappingURL=index.min.js.map
