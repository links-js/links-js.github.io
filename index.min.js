var getIconForOs,getOs,getTagClass,injectCss,isYaml,isYamlOrJson,splitThenAdd,stripQuotes;injectCss=function(n){var e,t,i;return t="inject-css",i=void 0,"string"==typeof n&&(n=n.trim(),i=0===n.indexOf("/")||0===n.indexOf("http:")||0===n.indexOf("https:")?"link":"style",e=document.getElementById(t),null!=e&&e.parentNode.removeChild(e),e=document.createElement(i),e.type="text/css",e.id=t,"link"===i?(e.rel="stylesheet",e.href=n):e.innerHTML=n,document.head.appendChild(e),e)},getOs=function(){var n;return n=navigator.platform.toUpperCase(),n.indexOf("MAC")>-1?"mac":n.indexOf("WIN")>-1?"windows":n.indexOf("LINUX")>-1?"linux":"windows"},isYamlOrJson=function(n){return/\.(ya?ml|json)$/.test(n)},isYaml=function(n){return/\.(ya?ml)$/.test(n)},stripQuotes=function(n){return n.replace(/^"(.*)"$/,"$1")},getTagClass=function(n){var e;return e=1,n>10&&(e=10),n>25&&(e=25),n>50&&(e=50),n>100&&(e=100),"tag-"+e},splitThenAdd=function(n,e){return n.split("\n").concat(e).join("\n")},getIconForOs=function(n){return n.includes("mac")?"fa-apple":n.includes("windows")?"fa-windows":n.includes("linux")?"fa-linux":""};
var getEngine,getTypeIcon,setDefaults,suggestionFn;setDefaults=function(n){return n.map(function(n){return"undefined"==typeof n.type&&(n.type="page"),n})},getEngine=function(n){return n=setDefaults(n),new Bloodhound({datumTokenizer:function(n){var e;return e=[],e=e.concat(Bloodhound.tokenizers.whitespace(n.name.replace(/[\(\)]/g,""))).concat(n.tags.map(function(n){return"#"+n})).concat(":"+n.type).concat(n.url)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:n,identify:function(n){return n.name}})},getTypeIcon=function(n){var e;switch(e="",n){case"file":e="fa-download";break;case"bookmark":e="fa-bookmark";break;default:e="fa-external-link-square"}return e},suggestionFn=function(n){var e;return e=n.tags.map(function(n){return"#"+n}).join(" "),'<div><div class="ta-obj">\n  <div class="ta-row">\n    <span class="name">'+n.name+'</span>\n    <span class="type"><i class="fa '+getTypeIcon(n.type)+'"></i></span>\n    <span class="tags">'+e+'</span>\n  </div>\n  <div class="ta-row">\n    <span class="url">'+n._url+"</span>\n  </div>\n</div></div>"};
angular.module("App",["ngRoute","ngStorage","angular-cache"]).constant("sourcesUrl","https://api.github.com/repos/links-js/db/contents/").filter("tagReplace",function(){return function(t){return t?t.replace(/tag:/gi,"#"):""}}).filter("noReferrer",function(){return function(t){return"https://href.li/?"+t}}).filter("filename",function(){return function(t){return t.split("/").slice(-1)[0]}}).filter("getFaviconUrl",function(){return function(t){return"https://www.google.com/s2/favicons?domain_url="+t}}).filter("getLastItem",function(){return function(t){return t.slice(-1)[0]}}).filter("hasYamlOrJson",function(){return function(t){return isYamlOrJson(t.name)}}).filter("getIconForOs",function(){return getIconForOs}).factory("LinksLoader",["$http","$q","$rootScope","$filter",function(t,e,n,r){var o,s,l,i;return s=function(t){var e,n;return n=t.config.url,e=null,e=e=isYaml(n)?jsyaml.load(t.data):t.data,e._url=n,e},l=function(t){return!!(Boolean(t)&&t instanceof Object&&t.hasOwnProperty("links"))||(console.error("Incorrect object:",t),!1)},i=function(t,e){var n;return n=e.links.map(function(t){return t._url=e._url,t._source=window.btoa(e._url),t}),t.concat(n)},o=function(t){return t.push(t.filter(l).reduce(i,[])),t},{load:function(){var l,i;return i=n.settings.url.split("\n").filter(function(t){return t.length>0}),l=i.map(function(n){return t.get(n).then(s,function(t){return console.error("HTTP error:",t),e.reject(t)})}),e.all(l).then(o).then(r("getLastItem"))}}}]).directive("myTypeahead",function(){return{restrict:"C",scope:!0,link:function(t,e,n){var r,o,s,l;return l={hint:!1,highlight:!0,minLength:1},r={name:"links",source:null,limit:t.$root.settings.limit,templates:{suggestion:suggestionFn},display:"name"},s=$(e[0]),o=null,t.$root.$watch("loadedLinks",function(e,n){return null!==e&&(r.source=getEngine(t.$root.loadedLinks),s.typeahead(l,r),s.bind("typeahead:select",function(e,n){var r;return r=t.$root.settings["page"===n.type?"openPage":"openFile"],r=stripQuotes(r),r="new"===r?"_blank":"_self",window.open(n.url,r)})),s.focus()}),t.$watch("term",function(){return s.val(t.term).trigger("input").focus()})}}}).factory("Settings",["$localStorage",function(t){var e,n;return n=["/db/db-global.yml","/db/db-"+getOs()+".yml"].join("\n"),e={url:n,openFile:"current",openPage:"new",cache:!0,limit:10},{reset:function(){return t.$reset(e)},storage:t.$default(e)}}]).controller("SettingsCtrl",["$scope","$rootScope","Settings","$http","sourcesUrl","$filter",function(t,e,n,r,o,s){var l;return l=function(){return t.status="Please reload page"},r.get(o).then(function(e){return t.sources=e.data.filter(s("hasYamlOrJson"))}),t.addSource=function(t){return e.settings.url=splitThenAdd(e.settings.url,"/db/"+t.path)},t.applyStyle=function(){injectCss(e.settings.css)},t.style=function(n){return e.settings.css="/styles/"+n+".css",t.applyStyle()},t.reset=function(){return n.reset(),l()},t.clear=function(){return r.defaults.cache.destroy(),l()}}]).controller("TagsCtrl",["$scope","$rootScope",function(t,e){var n;return n={},e.loadedLinks.map(function(t){return t.tags}).forEach(function(t){return t.forEach(function(t){return n[t]=n.hasOwnProperty(t)?n[t]+1:1})}),t.getClass=getTagClass,t.tags=n}]).controller("TypeCtrl",["$scope","$routeParams","$filter",function(t,e,n){return t.term=n("tagReplace")(e.term)}]).controller("ListCtrl",["$scope","$routeParams","$filter",function(t,e,n){var r,o;return r=null,o=function(){if(t.term.length>0)return t.change()},t.$root.$watch("loadedLinks",function(e,n){return r=getEngine(t.$root.loadedLinks),o()}),t.searchResults=[],t.change=function(){if(r)return r.search(t.term.trim(),function(e){return t.searchResults=e})},t.term=n("tagReplace")(e.term),o()}]).config(["$routeProvider",function(t){return t.when("/type/:term?",{templateUrl:"typeahead.html",controller:"TypeCtrl"}).when("/list/:term?",{templateUrl:"list.html",controller:"ListCtrl"}).when("/tags",{templateUrl:"tags.html"}).otherwise({redirectTo:"/type"})}]).run(["$http","$rootScope","Settings","CacheFactory","LinksLoader",function(t,e,n,r,o){return e.settings=n.storage,null!==e.settings.css&&injectCss(e.settings.css),e.settings.cache===!0&&(t.defaults.cache=r("defaultCache",{maxAge:9e5,cacheFlushInterval:36e5,deleteOnExpire:"aggressive",storageMode:"localStorage"})),o.load().then(function(t){return console.log("Links are loaded:",t.length),e.loadedLinks=t})}]);
//# sourceMappingURL=index.min.js.map
